<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Voucher - Print</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../../../js/auth.js"></script>
    <style>
        @media print {
            body { 
                margin: 0; 
                font-size: 9px;
            }
            .no-print { display: none !important; }
            .print-page { page-break-after: always; }
            
            /* Prevent page breaks for single page documents */
            .voucher-container {
                page-break-inside: avoid;
                max-height: 100vh;
                padding: 5px !important;
            }
            
            /* Reduce margins and spacing for print */
            .header {
                margin-bottom: 5px !important;
            }
            
            .company-name {
                font-size: 14px !important;
                margin-bottom: 2px !important;
            }
            
            .company-address {
                font-size: 9px !important;
                line-height: 1.2 !important;
            }
            
            .payment-to {
                font-size: 10px !important;
                margin-top: 5px !important;
            }
            
            .voucher-details {
                font-size: 9px !important;
            }
            
            .voucher-title {
                margin: 5px 0 !important;
                font-size: 16px !important;
            }
            
            .document-info {
                margin-bottom: 5px !important;
                padding: 4px !important;
            }
            
            .document-info h3 {
                font-size: 11px !important;
                margin-bottom: 5px !important;
                padding-bottom: 2px !important;
            }
            
            .document-info .info-item {
                padding: 2px 0 !important;
            }
            
            .document-info strong {
                font-size: 9px !important;
                min-width: 100px !important;
            }
            
            .document-info span {
                font-size: 9px !important;
            }
            
            .approval-boxes {
                margin-bottom: 5px !important;
                gap: 5px !important;
            }
            
            .approval-box {
                padding: 3px !important;
                min-height: 30px !important;
            }
            
            .approval-title {
                font-size: 9px !important;
                margin-bottom: 5px !important;
            }
            
            .approval-stamp {
                height: 18px !important;
                margin-bottom: 3px !important;
            }
            
            .approval-stamp-text {
                font-size: 8px !important;
                padding: 1px 4px !important;
            }
            
            .amount-section {
                margin-bottom: 5px !important;
            }
            
            .amount-row {
                margin-bottom: 5px !important;
            }
            
            .amount-value {
                font-size: 12px !important;
            }
            
            .footer-note {
                margin-top: 5px !important;
                font-size: 8px !important;
            }
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .voucher-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        @media print {
            .voucher-container {
                padding: 5px !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
                max-height: 100vh !important;
                overflow: hidden !important;
            }
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        @media print {
            .header {
                margin-bottom: 10px;
            }
        }
        
        .company-info {
            flex: 1;
        }
        
        .company-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .company-address {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .payment-to {
            margin-top: 10px;
            font-size: 14px;
        }
        
        .voucher-details {
            text-align: right;
            flex: 1;
        }
        
        .voucher-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            text-transform: uppercase;
        }
        
        @media print {
            .voucher-title {
                margin: 10px 0;
                font-size: 20px;
            }
        }
        
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        @media print {
            .payment-table {
                margin-bottom: 8px !important;
                font-size: 8px !important;
                page-break-inside: avoid !important;
            }
            
            .payment-table th,
            .payment-table td {
                padding: 2px !important;
                font-size: 8px !important;
            }
            
            /* Ensure all text elements are smaller for print */
            * {
                font-size: 9px !important;
            }
            
            /* Specific font sizes for print */
            .company-name { font-size: 14px !important; }
            .voucher-title { font-size: 16px !important; }
            .amount-value { font-size: 12px !important; }
            .footer-note { font-size: 8px !important; }
        }
        
        .payment-table th,
        .payment-table td {
            border: 1px solid #000;
            padding: 6px;
            text-align: left;
            font-size: 11px;
        }
        
        @media print {
            .payment-table th,
            .payment-table td {
                padding: 4px;
                font-size: 9px;
            }
        }
        
        .payment-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        
        .payment-table .total-row {
            font-weight: bold;
            background-color: #f9f9f9;
        }
        
        .payment-table .amount {
            text-align: right;
        }
        
        /* Page break controls for payment table - Removed forced breaks */
        @media print {
            /* Ensure total row stays with last items */
            .payment-table .total-row {
                page-break-inside: avoid;
            }
            
            /* Prevent page breaks within payment table for small content */
            .payment-table {
                page-break-inside: avoid;
            }
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .invoice-table th,
        .invoice-table td {
            border: 1px solid #000;
            padding: 6px;
            text-align: left;
        }
        
        .invoice-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        
        .invoice-table .amount {
            text-align: right;
        }
        
        .section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .supporting-docs {
            margin-bottom: 20px;
        }
        
        .doc-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .doc-item::after {
            content: '';
            flex: 1;
            border-bottom: 1px dotted #000;
            margin-left: 10px;
        }
        
        .approval-boxes {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        @media print {
            .approval-boxes {
                margin-bottom: 8px !important;
                gap: 5px !important;
                page-break-inside: avoid !important;
            }
        }
        
        .approval-box {
            flex: 1;
            min-width: 150px;
            border: 1px solid #000;
            padding: 10px;
            min-height: 60px;
            text-align: center;
        }
        
        @media print {
            .approval-box {
                padding: 6px;
                min-height: 45px;
            }
        }
        
        .approval-box {
            border: 1px solid #000;
            padding: 5px;
            min-height: 45px;
            text-align: center;
        }
        
        .approval-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .approval-signature {
            height: 30px;
            border-bottom: 1px solid #ccc;
        }
        
        /* Approval stamp styling */
        .approval-stamp {
            position: relative;
            width: 100%;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }
        
        .approval-stamp-text {
            color: #0056b3;
            font-weight: bold;
            font-size: 10px;
            border: 2px solid #0056b3;
            border-radius: 4px;
            padding: 2px 6px;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .amount-section {
            margin-bottom: 20px;
        }
        
        @media print {
            .amount-section {
                margin-bottom: 8px !important;
                page-break-inside: avoid !important;
            }
        }
        
        .amount-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .amount-label {
            font-weight: bold;
        }
        
        .amount-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .footer-note {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 20px;
            font-style: italic;
        }
        
        @media print {
            .footer-note {
                margin-top: 10px;
                font-size: 10px;
            }
            
            /* Page numbering styles for print */
            .page-number {
                position: fixed;
                bottom: 10px;
                right: 20px;
                font-size: 10px;
                color: #666;
                font-weight: bold;
            }
            
            /* Hide page number on screen */
            .page-number {
                display: none;
            }
            
            /* Show page number only when printing */
            @media print {
                .page-number {
                    display: block !important;
                }
            }
        }
        
        /* Page numbering styles */
        .page-number {
            position: fixed;
            bottom: 10px;
            right: 20px;
            font-size: 10px;
            color: #666;
            font-weight: bold;
            display: none;
        }
        
        @media print {
            .page-number {
                display: block !important;
            }
            
            /* CSS counters for page numbering */
            @page {
                counter-increment: page;
            }
            
            .page::after {
                content: counter(page);
            }
            
            .total-pages::after {
                content: counter(pages);
            }
        }
        
        .no-print {
            margin-bottom: 20px;
        }
        
        .print-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .print-button:hover {
            background-color: #0056b3;
        }
        
        .back-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .back-button:hover {
            background-color: #545b62;
        }
        
        .document-info {
            margin-bottom: 15px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        @media print {
            .document-info {
                margin-bottom: 8px !important;
                padding: 4px !important;
                background: white !important;
                border: 1px solid #000 !important;
                page-break-inside: avoid !important;
            }
        }
        
        .document-info h3 {
            font-weight: 700;
            margin-bottom: 10px;
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 5px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .document-info .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .document-info .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .document-info .info-item:last-child {
            border-bottom: none;
        }
        
        .document-info strong {
            color: #374151;
            font-weight: 600;
            font-size: 12px;
            min-width: 120px;
        }
        
        .document-info span {
            color: #1f2937;
            font-weight: 500;
            text-align: right;
            flex: 1;
            font-size: 12px;
        }
        
        .approval-details {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .approval-details h3 {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 2px solid #28a745;
            padding-bottom: 5px;
        }
        
        .attachments-section {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .attachments-section h3 {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            border-bottom: 2px solid #ffc107;
            padding-bottom: 3px;
            font-size: 14px;
        }
        
        .rejection-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #dc3545;
            background-color: #f8d7da;
            border-radius: 5px;
        }
        
        .rejection-section h3 {
            font-weight: bold;
            margin-bottom: 10px;
            color: #dc3545;
            border-bottom: 2px solid #dc3545;
            padding-bottom: 5px;
        }
        
        .rejection-section #rejectionRemarks {
            padding: 10px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            color: #721c24;
            white-space: pre-wrap;
        }
        
        @media print {
            .document-info,
            .approval-details,
            .attachments-section,
            .rejection-section {
                background-color: white !important;
                border: 1px solid #000 !important;
            }
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button class="back-button" onclick="goBack()">Back</button>
        <button class="print-button" onclick="handlePrint()">Print</button>
    </div>
    
            <div class="voucher-container">
            <div class="header">
                <div class="company-info">
                    <div class="company-name">PT KANSAI PAINT INDONESIA</div>
                    <div class="company-address">
                        Blok DD-7 & DD-6 Kawasan Industri MM2100 Danauindah<br>
                        Cikarang Barat Kab. Bekasi Jawa Barat 17530
                    </div>
                    <div class="payment-to">
                        Payment to: <span id="paymentTo">Rizki Fajar Putra</span>
                    </div>
                </div>
                <div class="voucher-details">
                    <div>Batch No.: <span id="batchNo">-</span></div>
                    <div>Voucher No. <span id="voucherNo">407B/03/25</span></div>
                    <div>Submission Date: <span id="submissionDate">09-June-2025</span></div>
                </div>
            </div>
            
            <div class="voucher-title">PAYMENT VOUCHER</div>
        
        <table class="payment-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Account</th>
                    <th>Detail Account</th>
                    <th>Debit</th>
                    <th>Credit</th>
                </tr>
            </thead>
            <tbody id="paymentTableBody">
                <!-- Payment rows will be populated by JavaScript -->
            </tbody>
        </table>
        
        <!-- Additional Document Information -->
        <div class="document-info">
            <h3>Document Information</h3>
            <div class="info-grid">
                <div>
                    <div class="info-item">
                        <strong>Reimburse No:</strong>
                        <span id="reimburseNo">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Requester:</strong>
                        <span id="requesterName">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Document Date:</strong>
                        <span id="documentDate">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Due Date:</strong>
                        <span id="dueDate">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Status:</strong>
                        <span id="documentStatus">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Journal Memo:</strong>
                        <span id="journalMemo">-</span>
                    </div>
                </div>
                <div>
                    <div class="info-item">
                        <strong>Document Currency:</strong>
                        <span id="documentCurrency">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Transfer Date:</strong>
                        <span id="transferDate">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Account Bank Transfer:</strong>
                        <span id="accountBankTransfer">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Total Transfer:</strong>
                        <span id="totalTransfer">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Remarks:</strong>
                        <span id="documentRemarks">-</span>
                    </div>
                    <div class="info-item">
                        <strong>Journal Remarks:</strong>
                        <span id="journalRemarks">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Attachments Section -->
        <div class="attachments-section" id="attachmentsSection" style="display: none;">
            <h3>Attachments</h3>
            <div id="attachmentsList">
                <!-- Attachments will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Rejection Remarks Section -->
        <div class="rejection-section" id="rejectionSection" style="display: none;">
            <h3>Rejection Remarks</h3>
            <div id="rejectionRemarks">
                <!-- Rejection remarks will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="approval-boxes">
            <div class="approval-box">
                <div class="approval-title">Prepared by :</div>
                <div class="approval-stamp">
                    <span class="approval-stamp-text">Signed</span>
                </div>
                <div style="text-align: center; margin-top: 3px; font-size: 10px;" id="preparedByBox">-</div>
                <div style="text-align: center; margin-top: 2px; font-size: 8px; color: #666;" id="preparedDateBox">-</div>
            </div>
            <div class="approval-box">
                <div class="approval-title">Checked by :</div>
                <div class="approval-stamp">
                    <span class="approval-stamp-text">Signed</span>
                </div>
                <div style="text-align: center; margin-top: 3px; font-size: 10px;" id="checkedByBox">-</div>
                <div style="text-align: center; margin-top: 2px; font-size: 8px; color: #666;" id="checkedDateBox">-</div>
            </div>
            <div class="approval-box">
                <div class="approval-title">Acknowledged by :</div>
                <div class="approval-stamp">
                    <span class="approval-stamp-text">Signed</span>
                </div>
                <div style="text-align: center; margin-top: 3px; font-size: 10px;" id="acknowledgedByBox">-</div>
                <div style="text-align: center; margin-top: 2px; font-size: 8px; color: #666;" id="acknowledgedDateBox">-</div>
            </div>
            <div class="approval-box">
                <div class="approval-title">Approved by :</div>
                <div class="approval-stamp">
                    <span class="approval-stamp-text">Approved</span>
                </div>
                <div style="text-align: center; margin-top: 3px; font-size: 10px;" id="approvedBy">N. Widya M.</div>
                <div style="text-align: center; margin-top: 2px; font-size: 8px; color: #666;" id="approvedDateBox">-</div>
            </div>
        </div>
        
        <div class="amount-section">
            <div class="amount-row">
                <span class="amount-label">Amount Payment:</span>
                <span class="amount-value" id="amountPayment">IDR 1,492,532.00</span>
            </div>
            <div class="amount-row">
                <span class="amount-label">Amount in Word:</span>
                <span class="amount-value" id="amountInWord">ONE MILLION FOUR HUNDRED NINETY-TWO THOUSAND FIVE HUNDRED THIRTY-TWO RUPIAH</span>
            </div>
        </div>
        
        <div class="footer-note">
            Generated by Expressiv system
        </div>
        
        <!-- Page numbering -->
        <div class="page-number" id="pageNumber"></div>
    </div>

    <script>
        // Function to go back to the previous page
        function goBack() {
            window.history.back();
        }
        
        // Function to format currency
        function formatCurrency(number) {
            if (number === null || number === undefined || number === '') {
                return '0';
            }
            
            const num = parseFloat(number);
            if (isNaN(num)) {
                return '0';
            }
            
            return num.toLocaleString('id-ID', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Function to get bank account name based on account code
        // Function to get bank account name based on COA
        function getBankAccountName(accountCode) {
            const accountMapping = {
                '1110': 'Cash on hand (Rp)',
                '1210': 'Mizuho Bank (Rp)',
                '1211': 'Mizuho Bank (US$)',
                '1212': 'Mizuho (JPY)',
                '1213': 'MUFG Bank (Rp)',
                '1214': 'MUFG Bank (US$)',
                '1215': 'MUFG Bank (Jpy)',
                '1222': 'CIMB NIAGA (Rp)',
                '1310': 'Saving Account (IDR, Mizuho)',
                '1313': 'Saving Account (IDR, MUFG)',
                '1316': 'Saving Account (IDR, CIMB NIAGA)'
            };
            
            return accountMapping[accountCode] || 'Current Account (IDR,BTMU-UFJ)';
        }
        
        // Function to convert number to words
        function numberToWords(num) {
            const ones = ['', 'ONE', 'TWO', 'THREE', 'FOUR', 'FIVE', 'SIX', 'SEVEN', 'EIGHT', 'NINE'];
            const tens = ['', '', 'TWENTY', 'THIRTY', 'FORTY', 'FIFTY', 'SIXTY', 'SEVENTY', 'EIGHTY', 'NINETY'];
            const teens = ['TEN', 'ELEVEN', 'TWELVE', 'THIRTEEN', 'FOURTEEN', 'FIFTEEN', 'SIXTEEN', 'SEVENTEEN', 'EIGHTEEN', 'NINETEEN'];
            
            if (num === 0) return 'ZERO';
            
            function convertLessThanOneThousand(n) {
                if (n === 0) return '';
                
                if (n < 10) return ones[n];
                if (n < 20) return teens[n - 10];
                if (n < 100) {
                    return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + ones[n % 10] : '');
                }
                if (n < 1000) {
                    return ones[Math.floor(n / 10 / 10)] + ' HUNDRED' + (n % 100 !== 0 ? ' ' + convertLessThanOneThousand(n % 100) : '');
                }
            }
            
            function convert(n) {
                if (n === 0) return 'ZERO';
                
                const billions = Math.floor(n / 1000000000);
                const millions = Math.floor((n % 1000000000) / 1000000);
                const thousands = Math.floor((n % 1000000) / 1000);
                const remainder = n % 1000;
                
                let result = '';
                
                if (billions > 0) {
                    result += convertLessThanOneThousand(billions) + ' BILLION';
                }
                if (millions > 0) {
                    result += (result ? ' ' : '') + convertLessThanOneThousand(millions) + ' MILLION';
                }
                if (thousands > 0) {
                    result += (result ? ' ' : '') + convertLessThanOneThousand(thousands) + ' THOUSAND';
                }
                if (remainder > 0) {
                    result += (result ? ' ' : '') + convertLessThanOneThousand(remainder);
                }
                
                return result;
            }
            
            return convert(Math.floor(num)) + ' RUPIAH';
        }
        
        // Function to populate voucher data
        function populateVoucherData(data) {
            // Set basic information
            document.getElementById('paymentTo').textContent = data.cardName || 'Rizki Fajar Putra';
            document.getElementById('voucherNo').textContent = data.docNum || '407B/03/25';
            document.getElementById('submissionDate').textContent = data.docDate ? new Date(data.docDate).toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            }) : '09-June-2025';
            
            // Populate additional document information
            document.getElementById('reimburseNo').textContent = data.counterRef || '-';
            document.getElementById('requesterName').textContent = data.requesterName || '-';
            document.getElementById('documentDate').textContent = data.docDate ? new Date(data.docDate).toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            }) : '-';
            document.getElementById('dueDate').textContent = data.docDueDate ? new Date(data.docDueDate).toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            }) : '-';
            document.getElementById('documentStatus').textContent = data.approval?.approvalStatus || 'Prepared';
            document.getElementById('journalMemo').textContent = data.jrnlMemo || '-';
            document.getElementById('documentCurrency').textContent = data.docCurr || 'IDR';
            document.getElementById('transferDate').textContent = data.trsfrDate ? new Date(data.trsfrDate).toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            }) : '-';
            document.getElementById('accountBankTransfer').textContent = data.trsfrAcct || '-';
            
            // Store bank account name for use in payment table
            // Note: trsfrAcctName is not available in API response
            // Using hardcoded value or mapping based on trsfrAcct
            const bankAccountName = getBankAccountName(data.trsfrAcct) || 'Current Account (IDR,BTMU-UFJ)';
            // Calculate total from lines for Total Transfer
            let totalFromLines = 0;
            if (data.lines && data.lines.length > 0) {
                data.lines.forEach(line => {
                    totalFromLines += line.sumApplied || 0;
                });
            }
            document.getElementById('totalTransfer').textContent = `IDR ${formatCurrency(totalFromLines)}`;
            console.log('PrintOPReim - Remarks data:', data.remarks);
            console.log('PrintOPReim - Journal Remarks data:', data.journalRemarks);
            console.log('PrintOPReim - Comments data:', data.comments);
            console.log('PrintOPReim - JrnlMemo data:', data.jrnlMemo);
            document.getElementById('documentRemarks').textContent = data.remarks || data.comments || '-';
            document.getElementById('journalRemarks').textContent = data.journalRemarks || data.jrnlMemo || '-';
            
            // Populate payment table
            const paymentTableBody = document.getElementById('paymentTableBody');
            paymentTableBody.innerHTML = '';
            
            let totalDebit = 0;
            let totalCredit = 0;
            
            if (data.lines && data.lines.length > 0) {
                // For small content, show all items to fit on one page
                // If total amount is small (less than 1 million), show all items
                const totalAmount = data.lines.reduce((sum, line) => sum + (line.sumApplied || 0), 0);
                const isSmallAmount = totalAmount < 1000000; // Less than 1 million
                const maxItemsPerPage = isSmallAmount ? data.lines.length : Math.min(data.lines.length, 2);
                const itemsToShow = data.lines.slice(0, maxItemsPerPage);
                
                itemsToShow.forEach((line, index) => {
                    const row = document.createElement('tr');
                    const amount = line.sumApplied || 0;
                    
                    row.innerHTML = `
                        <td>${line.descrip || 'Medical for Children, Rheanika - Rizki Fajar Putra'}</td>
                        <td>${line.acctCode || '7245'}</td>
                        <td>${line.acctName || 'Welfare Expense - A'}</td>
                        <td class="amount">IDR ${formatCurrency(amount)}</td>
                        <td class="amount"></td>
                    `;
                    paymentTableBody.appendChild(row);
                    
                    totalDebit += amount;
                });
                
                // Add note if there are more items and amount is large
                if (data.lines.length > maxItemsPerPage && !isSmallAmount) {
                    const noteRow = document.createElement('tr');
                    noteRow.innerHTML = `
                        <td colspan="5" style="text-align: center; font-style: italic; color: #666; font-size: 8px;">
                            Note: Showing first ${maxItemsPerPage} items. Total items: ${data.lines.length}
                        </td>
                    `;
                    paymentTableBody.appendChild(noteRow);
                }
                
                totalCredit = totalDebit;
                
                // Add credit row for bank account (balancing entry)
                const creditRow = document.createElement('tr');
                creditRow.innerHTML = `
                    <td></td>
                    <td>${data.trsfrAcct || '1213'}</td>
                    <td>${bankAccountName}</td>
                    <td class="amount">IDR 0.00</td>
                    <td class="amount">IDR ${formatCurrency(totalDebit)}</td>
                `;
                paymentTableBody.appendChild(creditRow);
                
                // Add total row
                const totalRow = document.createElement('tr');
                totalRow.className = 'total-row';
                totalRow.innerHTML = `
                    <td style="text-align: right;"><strong>Total</strong></td>
                    <td></td>
                    <td></td>
                    <td class="amount"><strong>IDR ${formatCurrency(totalDebit)}</strong></td>
                    <td class="amount"><strong>IDR ${formatCurrency(totalDebit)}</strong></td>
                `;
                paymentTableBody.appendChild(totalRow);
            }
            

            

            
            // Set approval name
            const approvedBy = document.getElementById('approvedBy');
            if (data.approval && data.approval.approvedByName) {
                approvedBy.textContent = data.approval.approvedByName;
            } else if (data.approval && data.approval.approvedBy) {
                approvedBy.textContent = data.approval.approvedBy;
            }
            

            
            // Populate approval boxes
            document.getElementById('preparedByBox').textContent = data.approval?.preparedByName || '-';
            document.getElementById('checkedByBox').textContent = data.approval?.checkedByName || '-';
            document.getElementById('acknowledgedByBox').textContent = data.approval?.acknowledgedByName || '-';
            
            // Populate approval dates
            const formatDate = (dateString) => {
                if (!dateString) return '-';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            };
            
            document.getElementById('preparedDateBox').textContent = formatDate(data.approval?.preparedDate);
            document.getElementById('checkedDateBox').textContent = formatDate(data.approval?.checkedDate);
            document.getElementById('acknowledgedDateBox').textContent = formatDate(data.approval?.acknowledgedDate);
            document.getElementById('approvedDateBox').textContent = formatDate(data.approval?.approvedDate);
            
            // Display attachments if available
            if (data.attachments && data.attachments.length > 0) {
                const attachmentsSection = document.getElementById('attachmentsSection');
                const attachmentsList = document.getElementById('attachmentsList');
                
                if (attachmentsSection && attachmentsList) {
                    attachmentsSection.style.display = 'block';
                    attachmentsList.innerHTML = '';
                    
                    data.attachments.forEach(attachment => {
                        const attachmentItem = document.createElement('div');
                        attachmentItem.style.cssText = 'padding: 3px; border-bottom: 1px solid #eee; font-size: 11px;';
                        attachmentItem.innerHTML = `
                            <span style="font-weight: bold;">File:</span> ${attachment.fileName || 'Attachment'}
                            <span style="float: right; color: #666;">ID: ${attachment.id || 'N/A'}</span>
                        `;
                        attachmentsList.appendChild(attachmentItem);
                    });
                }
            }
            
            // Display rejection remarks if available
            if (data.approval && data.approval.rejectionRemarks) {
                const rejectionSection = document.getElementById('rejectionSection');
                const rejectionRemarks = document.getElementById('rejectionRemarks');
                
                if (rejectionSection && rejectionRemarks) {
                    rejectionSection.style.display = 'block';
                    rejectionRemarks.textContent = data.approval.rejectionRemarks;
                }
            }
            

            
            // Set amounts
            document.getElementById('amountPayment').textContent = `IDR ${formatCurrency(totalDebit)}`;
            document.getElementById('amountInWord').textContent = numberToWords(totalDebit);
        }
        
        // Function to handle page numbering
        function updatePageNumbers() {
            const pageNumberElement = document.getElementById('pageNumber');
            if (pageNumberElement) {
                // For print, we'll use CSS counters
                pageNumberElement.innerHTML = 'Page <span class="page"></span> of <span class="total-pages"></span>';
            }
        }
        
        // Function to handle print event
        function handlePrint() {
            // Update page numbers before printing
            updatePageNumbers();
            
            // Add CSS for page numbering
            const style = document.createElement('style');
            style.textContent = `
                @page {
                    counter-increment: page;
                }
                
                .page::after {
                    content: counter(page);
                }
                
                .total-pages::after {
                    content: counter(pages);
                }
            `;
            document.head.appendChild(style);
            
            // Trigger print
            window.print();
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Get data from URL parameters or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const docId = urlParams.get('docId');
            
            if (docId) {
                // Load data from localStorage or make API call
                const storedData = localStorage.getItem(`opReimData_${docId}`);
                if (storedData) {
                    const data = JSON.parse(storedData);
                    populateVoucherData(data);
                } else {
                    // If no stored data, use default values
                    populateVoucherData({});
                }
            } else {
                // Use default values if no docId
                populateVoucherData({});
            }
            
            // Initialize page numbering
            updatePageNumbers();
        });
    </script>
</body>